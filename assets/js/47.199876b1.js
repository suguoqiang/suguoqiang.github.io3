(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{542:function(a,t,s){"use strict";s.r(t);var e=s(6),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h3",{attrs:{id:"安装准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装准备"}},[a._v("#")]),a._v(" 安装准备")]),a._v(" "),s("blockquote",[s("p",[a._v("安装前确认已安装了JDK、Git、Maven,并配置相应的环境变量。")])]),a._v(" "),s("p",[a._v("1、安装maven：")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("wget http:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("mirror"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("bit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("edu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cn"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("apache"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("maven"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("maven"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("3"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("4"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("binaries"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("apache"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("maven"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("4"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("tar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("gz\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 解压")]),a._v("\ntar vxf apache"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("maven"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("0"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("tar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("gz\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 移动")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" apache"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("maven"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("0 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("usr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("local"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("maven3\n")])])]),s("p",[a._v("2、修改环境变量，在/etc/profile中添加：")]),a._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("MAVEN_HOME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("/usr/local/maven3")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("MAVEN_HOME")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("PATH=${PATH}:${MAVEN_HOME}/bin")]),a._v("\n")])])]),s("p",[a._v("3、执行"),s("code",[a._v("source /etc/profile")]),a._v("使环境变量生效。然后"),s("code",[a._v("mvn -v")]),a._v("查看是否安装成功。")]),a._v(" "),s("p",[a._v("4、安装Jdk（必须操作）")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#这里安装openjdk")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" java-1.8.0-openjdk.x86_64\n")])])]),s("blockquote",[s("p",[a._v("java -verbose 查看安装的路径地址")])]),a._v(" "),s("h3",{attrs:{id:"安装jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装jenkins"}},[a._v("#")]),a._v(" 安装jenkins")]),a._v(" "),s("h4",{attrs:{id:"方式1"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方式1"}},[a._v("#")]),a._v(" 方式1")]),a._v(" "),s("p",[a._v("1、下载安装包：")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ sudo mkdir "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("opt"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jenkins && cd "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("opt"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jenkins\n$ "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#wget http://mirrors.jenkins.io/war/2.83/jenkins.war")]),a._v("\n$ wget https:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("mirrors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("tuna"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("tsinghua"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("edu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("cn"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jenkins"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("war"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("stable"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("150"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("3"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jenkins"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("war\n")])])]),s("p",[a._v("2、启动服务(War包自带Jetty服务器)")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("nohup java "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("jar jenkins"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("war "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("httpPort=8080 > temp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("txt &\n")])])]),s("p",[a._v("3、第一次启动Jenkins时，会自动生成一个随机的口令。该口令用于，在打开"),s("code",[a._v("localhost:8080")]),a._v("后输入的密码。这里可以直接通过"),s("code",[a._v("cat temp.txt")]),a._v("查看密码。")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://cdn.gqsu.top/feign01-2.png",alt:""}})]),a._v(" "),s("p",[a._v("默认的用户为："),s("code",[a._v("admin")]),a._v(";\n如果初始密码不记得了，请在"),s("code",[a._v("/root/.jenkins/secrets/initialAdminPassword")]),a._v("下查看")]),a._v(" "),s("p",[a._v("登陆成功后，可在控制台更改创建用户以及密码。安装推荐的插件。")]),a._v(" "),s("h4",{attrs:{id:"方式2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方式2"}},[a._v("#")]),a._v(" 方式2")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("##1、安装")]),a._v("\n$ sudo wget "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("O "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("etc"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("yum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("repos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("d"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jenkins"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("repo http:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("pkg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jenkins"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("ci"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("org"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("redhat"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jenkins"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("repo\n$ sudo rpm "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("import https:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jenkins"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("ci"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("org"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("redhat"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jenkins"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("ci"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("key\n$ sudo yum install jenkins\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("##2、启动")]),a._v("\n$ service jenkins "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("start")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("##3、访问8080端口即可，密码查看")]),a._v("\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("lib"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jenkins"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("secrets"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("initialAdminPassword\n")])])]),s("h3",{attrs:{id:"全局工具配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#全局工具配置"}},[a._v("#")]),a._v(" 全局工具配置")]),a._v(" "),s("blockquote",[s("p",[a._v("主要需要指定 JDK，MAVEN和 Git 等信息")])]),a._v(" "),s("p",[a._v("如果忘记安装路径，如：java，可以通过 "),s("code",[a._v("which java")]),a._v("查看：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# which java")]),a._v("\n/usr/bin/java\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ls -lrt /usr/bin/java")]),a._v("\nlrwxrwxrwx "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("29")]),a._v(" 07:03 /usr/bin/java -"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /etc/alternatives/java\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ls -lrt /etc/alternatives/java")]),a._v("\nlrwxrwxrwx "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" root root "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("41")]),a._v(" Oct "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("29")]),a._v(" 07:03 /etc/alternatives/java -"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /usr/java/jdk1.8.0_191-amd64/jre/bin/java\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ")]),a._v("\n")])])]),s("p",[a._v("最终找到了jre的路径为:"),s("code",[a._v("/usr/java/jdk1.8.0_191-amd64/jre/bin/java")]),a._v("，需要人肉识别下根路径。于是，可以配置jdk：\n"),s("img",{attrs:{src:"http://cdn.gqsu.top/feign01-3.png",alt:""}}),a._v("\n同样的操作，找到git和maven目录，配置如下：\n"),s("img",{attrs:{src:"http://cdn.gqsu.top/feign01-4.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"构建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建"}},[a._v("#")]),a._v(" 构建")]),a._v(" "),s("h4",{attrs:{id:"方式1-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方式1-2"}},[a._v("#")]),a._v(" 方式1")]),a._v(" "),s("p",[a._v("1、根据使用的代码托管平台，在系统管理->插件管理->可选插件中搜索对应的插件进行安装。")]),a._v(" "),s("p",[a._v("2、创建任务配置，这里以 pigx-ui 为例：\n"),s("img",{attrs:{src:"http://cdn.gqsu.top/feign01-5.png",alt:""}})]),a._v(" "),s("p",[a._v("3、确定之后，需要配置 源码管理，填入以下参数：")]),a._v(" "),s("ul",[s("li",[a._v("源码管理类型选择git")]),a._v(" "),s("li",[a._v("仓库地址可以填入项目地址，Credentials区域配置的是自己仓库的账号和密码，id它是会自动进行识别的。")]),a._v(" "),s("li",[a._v("选择需要构建的分支，例如: */master")])]),a._v(" "),s("p",[a._v("4、构建触发器，可以根据需要在提交代码时主动出发，需要配置webhook")]),a._v(" "),s("p",[a._v("5、构建，填写shell。（这里以前端pigx-ui为例）")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${WORKSPACE}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" --registry"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("https://registry.npm.taobao.org\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" run build\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" dist "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" -r * /opt/nginx/html/*\n")])])]),s("p",[a._v("6、构建后操作\n为了提高复用性，使每次的构建环境尽可能一致，我在构建后操作里选择一个Delete workspace when build is done,这样，在构建完成时，可以删掉工作空间，避免工作空间中已有的文件造成干扰。")]),a._v(" "),s("p",[a._v("7、经过上述步骤就构建完成了，点击“立即构建”，然后可在控制台查看构建情况。")]),a._v(" "),s("p",[a._v("关于 后端 pigx，需要调用一个顶层 maven")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("clean\npackage -Dmaven.test.skip"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n")])])]),s("p",[s("img",{attrs:{src:"http://cdn.gqsu.top/feign01-6.png",alt:""}})]),a._v(" "),s("p",[a._v("然后执行相应的shell")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${WORKSPACE}")]),a._v("\ndocker-compose down\ndocker system prune -a -f\ndocker-compose build\ndocker-compose up -d\n")])])]),s("h3",{attrs:{id:"配置webhook从而自动完成构建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置webhook从而自动完成构建"}},[a._v("#")]),a._v(" 配置webhook从而自动完成构建")]),a._v(" "),s("blockquote",[s("p",[a._v("不同代码仓库，配置不完全相同")])]),a._v(" "),s("h4",{attrs:{id:"方式2-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方式2-2"}},[a._v("#")]),a._v(" 方式2")]),a._v(" "),s("blockquote",[s("p",[a._v("省略重复步骤")])]),a._v(" "),s("p",[a._v("1、选择自由风格，参数化配置：\n"),s("img",{attrs:{src:"http://cdn.gqsu.top/Jenkins02-01.png",alt:""}}),a._v(" "),s("img",{attrs:{src:"http://cdn.gqsu.top/Jenkins02-02.png",alt:""}})]),a._v(" "),s("blockquote",[s("p",[a._v("jar_path : 本意是准备项目打包后的 jar 位置，其实这里是 Jenkins 工作空间\nspring_profile：这个是读取配置文件前缀，比如 dev，test，prod\njar_name：jar 包名称\nproject_name：项目名称")])]),a._v(" "),s("p",[a._v("2、配置Git：\n"),s("img",{attrs:{src:"http://cdn.gqsu.top/Jenkins02-03.png",alt:""}})]),a._v(" "),s("p",[a._v("3、配置Build")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ mvn clean install "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("Dmaven"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("skip=true\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$spring_profile")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$jar_path")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$jar_name")]),a._v("\n\n$ cd "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("usr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("local"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("shell"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("stop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("sh "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$jar_name")]),a._v("\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Execute shell Finish"')]),a._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("startup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("sh "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$spring_profile")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$jar_path")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$jar_name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$project_name")]),a._v("\n")])])]),s("p",[s("img",{attrs:{src:"http://cdn.gqsu.top/Jenkins02-04.png",alt:""}})]),a._v(" "),s("p",[a._v("另外，在创建两个sh，stop.sh和start.sh")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#stop.sh")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("jar_name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${1}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Stopping"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${jar_name}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("pid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" -ef "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("jar_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" -v "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("awk")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{print "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$2")]),a._v("}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\nif"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" -n "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$pid")]),a._v('"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n   "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"kill -9 的pid:"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$pid")]),a._v("\n   "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("kill")]),a._v(" -9 "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$pid")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n")])])]),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#start.sh")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("spring_profile")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${1}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("jar_path")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${2}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("jar_name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${3}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("project_name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${4}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${jar_path}")]),a._v("/"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${project_name}")]),a._v("/target/\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${jar_path}")]),a._v("/"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${project_name}")]),a._v("/target/\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("nohup")]),a._v(" java -jar "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${jar_name}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BUILD_ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("dontKillMe "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("nohup")]),a._v(" java -jar "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${jar_name}")]),a._v(" --spring.profiles.active"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${spring_profile}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])])]),s("p",[a._v("4、运行\n"),s("img",{attrs:{src:"http://cdn.gqsu.top/Jenkins02-05.png",alt:""}}),a._v("\n如果报错："),s("code",[a._v("mvn：command not found")]),a._v("，这里我解决的方式是将 mvn 命令也指向 / usr/bin/mvn")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ ln "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("usr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("local"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("apache"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("maven"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("4"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("bin"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("mvn "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("usr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("bin"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("mvn\n")])])]),s("h4",{attrs:{id:"配置gogs的webhook"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置gogs的webhook"}},[a._v("#")]),a._v(" 配置gogs的webhook")]),a._v(" "),s("p",[s("code",[a._v("http://jenkinsIP:jenkins端口/gogs-webhook/?job=jenkins中的任务名")]),a._v("\n以pigx-ui的环境为例，只需要填入\n"),s("code",[a._v("https://jenkins.pig4cloud.com/gogs-webhook/?job=pigx-ui")])]),a._v(" "),s("h4",{attrs:{id:"配置github的webhook"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置github的webhook"}},[a._v("#")]),a._v(" 配置github的webhook")]),a._v(" "),s("p",[a._v("1、进入"),s("code",[a._v("github --\x3e setting --\x3e Developer settings --\x3e Personal Access Token --\x3e Generate new token")]),a._v("。勾选repo和admin：repo_hook。生成access_token。")]),a._v(" "),s("p",[a._v("2、进入GitHub上指定的"),s("code",[a._v("项目 --\x3e setting --\x3e WebHooks&Services --\x3e add webhook --\x3e")]),a._v(" 输入刚刚部署jenkins的服务器的IP。")]),a._v(" "),s("p",[a._v("3、jekins安装github配置，系统管理--\x3e插件管理--\x3e可选插件github。系统管理 --\x3e 系统设置 --\x3e GitHub --\x3e Add GitHub Sever。添加凭证，选择Secret text，拷贝之前access_token，其他可不填。确定之后，点击连接测试，看是否可运行。")]),a._v(" "),s("blockquote",[s("p",[a._v("当然，在构建触发器 Build Triggers 中，也选择在什么情况下出发构建操作，可选择轮训scm(即代码有变动即出发)。输入："),s("code",[a._v("H/10 * * * *")]),a._v("，每隔10分钟检测一次。")])]),a._v(" "),s("h3",{attrs:{id:"配置构建完成通知-钉钉通知"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置构建完成通知-钉钉通知"}},[a._v("#")]),a._v(" 配置构建完成通知: 钉钉通知")]),a._v(" "),s("p",[a._v("在插件管理的可选插件里搜索：dingding，安装Dingding[钉钉]插件。然后，点击具体项目，点击左侧configuration进入配置管理，然后找到前往构建后的操作，点击“增加构建后操作步骤”->选择“钉钉通知配置器”。在url里输入钉钉对应的access token（即钉钉机器人的webhook中的accesstoken部分）")]),a._v(" "),s("h3",{attrs:{id:"其他"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[a._v("#")]),a._v(" 其他")]),a._v(" "),s("p",[a._v("1、关于重启和关闭,直接添加相应的关键字即可")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重启Jenkies")]),a._v("\nhttp:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("localhost:8080"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("restart\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#关闭Jenkies")]),a._v("\nhttp:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("localhost:8080"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("exit")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#重新加载配置信息")]),a._v("\nhttp:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("localhost:8080"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("reload\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#或者")]),a._v("\nnet "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("start")]),a._v(" jenkins    "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("  net stop jenkins\n\n")])])]),s("p",[a._v("2、在系统管理-插件管理里安装一些推荐的插件，或者升级一些必要的插件。推荐安装"),s("code",[a._v("Git plugin")]),a._v("和"),s("code",[a._v("Maven Integration")]),a._v("，"),s("code",[a._v("publish over SSH")]),a._v("。")]),a._v(" "),s("p",[a._v("3、在系统管理-全局工具配置里，取消自动安装（不推荐使用自动，可手动安装），添加JDK和Maven环境依赖")]),a._v(" "),s("p",[a._v("4、配置 SSH免登陆，参考："),s("a",{attrs:{href:"http://www.ityouknow.com/springboot/2017/11/11/springboot-jenkins.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("纯洁的微笑"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("5、构建项目。选择新建任务，输入项目名称，选择maven项目,确定，然后选择"),s("code",[a._v("丢弃旧的构建")]),a._v(",自定义设置保持构建的天数和最大个数,源码管理选择git，")])])}),[],!1,null,null,null);t.default=r.exports}}]);