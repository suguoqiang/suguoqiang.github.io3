(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{565:function(s,t,a){"use strict";a.r(t);var r=a(6),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"k3s简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k3s简介"}},[s._v("#")]),s._v(" K3S简介")]),s._v(" "),a("p",[s._v("K8S的简化版，50MB，支持多平台。")]),s._v(" "),a("h3",{attrs:{id:"部署-高可用-mysql数据源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署-高可用-mysql数据源"}},[s._v("#")]),s._v(" 部署（高可用，MySQL数据源）")]),s._v(" "),a("p",[s._v("Mysql/nginx/ui      172.17.0.150     2C/4G\nk3s-server-1       172.17.0.151     1C/2G\nk3s-server-2       172.17.0.152     1C/2G\nk3s-agent-1       172.17.0.153     1C/2G\nk3s-agent-2       172.17.0.154     1C/2G")]),s._v(" "),a("h3",{attrs:{id:"部署前准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署前准备"}},[s._v("#")]),s._v(" 部署前准备")]),s._v(" "),a("p",[s._v("1、150上安装 mysql 数据源，创建一个库xx；")]),s._v(" "),a("p",[s._v("2、150上安装nginx，提供负载均衡能力，分别指向151和152上。")]),s._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v("upstream k3sList {\n    server 172.17.0.151:6443;\n    server 172.17.0.152:6443;\n}\n\nserver {\n    listen 6443;\n    proxy_pass k3sList;\n}\n")])])]),a("h3",{attrs:{id:"部署脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署脚本"}},[s._v("#")]),s._v(" 部署脚本")]),s._v(" "),a("h4",{attrs:{id:"_1、安装k3s-server-两台机器都执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、安装k3s-server-两台机器都执行"}},[s._v("#")]),s._v(" 1、安装k3s-server（两台机器都执行）")]),s._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[s._v("export INSTALL_K3S_VERSION=v1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("3"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k3s1\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##内置版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('##export INSTALL_K3S_EXEC="--docker --kube-apiserver-arg service-node-port-range=1-65000 --no-deploy traefik --write-kubeconfig  ~/.kube/config --write-kubeconfig-mode 666"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##mysql版本")]),s._v("\nexport INSTALL_K3S_EXEC="),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--datastore-endpoint=mysql://root:root@tcp(172.17.0.150:3306)/k3s --docker --kube-apiserver-arg service-node-port-range=1-65000 --no-deploy traefik --write-kubeconfig  ~/.kube/config --write-kubeconfig-mode 666"')]),s._v("\n\ncurl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sfL https:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rancher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k3s"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k3s"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" INSTALL_K3S_MIRROR=cn sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看节点状态，此时mysqlxx库中自动建立了表kine，并自动做了同步")]),s._v("\nkubectl get nodes\n")])])]),a("h4",{attrs:{id:"_2、安装k3s-agent-两台机器都执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装k3s-agent-两台机器都执行"}},[s._v("#")]),s._v(" 2、安装k3s-agent（两台机器都执行）")]),s._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rancher"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k3s"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token  \n\nexport INSTALL_K3S_VERSION=v1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("3"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k3s1\n\nexport K3S_TOKEN=XXXXXX\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##这里的地址是nginx负载均衡地址")]),s._v("\nexport K3S_URL=https:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("172"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("150:6443\n\nexport INSTALL_K3S_EXEC="),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--docker --kube-apiserver-arg service-node-port-range=1-65000 --no-deploy traefik --write-kubeconfig ~/.kube/config --write-kubeconfig-mode 666"')]),s._v("\n\ncurl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sfL https:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rancher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k3s"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k3s"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" INSTALL_K3S_MIRROR=cn sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n")])])]),a("h4",{attrs:{id:"安装rancherui"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装rancherui"}},[s._v("#")]),s._v(" 安装RancherUI")]),s._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[s._v("docker run "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rancher"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rancher"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rancher"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("restart=unless"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stopped "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name rancher"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p 9443:443 rancher"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rancher:stable\n")])])]),a("p",[s._v("首次登陆需要配置证书，随便设置，选择跳过证书栏目。复制最下面的一行系统代码，然后在任意节点，如151或者152上执行即可。导入成功，后可以看到全部的节点状态。")]),s._v(" "),a("h4",{attrs:{id:"界面部署服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#界面部署服务"}},[s._v("#")]),s._v(" 界面部署服务")]),s._v(" "),a("p",[s._v("点“部署服务”，设置名称和镜像文件地址。如有需要设置环境变量参数。")])])}),[],!1,null,null,null);t.default=e.exports}}]);