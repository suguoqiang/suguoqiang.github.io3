(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{511:function(t,a,s){"use strict";s.r(a);var e=s(6),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h3",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),s("blockquote",[s("p",[t._v("使用教程参考："),s("a",{attrs:{href:"http://docs.docker-cn.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),s("OutboundLink")],1)])]),t._v(" "),s("h4",{attrs:{id:"安装最新版-docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装最新版-docker"}},[t._v("#")]),t._v(" 安装最新版 docker")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 安装依赖")]),t._v("\n$ sudo yum install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y yum"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("utils device"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("mapper"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("persistent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" lvm2\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 安装国内阿里源，不推荐采用官方源，访问太慢")]),t._v("\n$ sudo yum"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("manager \\\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add-repo")]),t._v(" \\\n    https:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mirrors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aliyun"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ce"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("linux"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("centos"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ce"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("repo\n    \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 更新 yum 软件源缓存，并安装 docker-ce")]),t._v("\n$ sudo yum makecache fast\n$ sudo yum install docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ce\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 启动")]),t._v("\n$ sudo systemctl enable docker\n$ sudo systemctl "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),t._v(" docker\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## （可选）默认情况下，只有 root 用户和 docker 组的用户才可以访问 Docker（不推荐直接用root）")]),t._v("\n$ useradd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("g docker docker\n$ passwd docker\n$ su docker\n$ docker "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("version\n")])])]),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"title"}),s("p",[t._v("如果出现：Problem: package docker-ce-3:19.03.8-3.el7.x86_64 requires containerd.io >= 1.2.2-> 3, but none of the providers can be installed")]),t._v(" "),s("ul",[s("li",[t._v("cannot install the best candidate for the job")]),t._v(" "),s("li",[t._v("package containerd.io-1.2.10-3.2.el7.x86_64 is excluded")]),t._v(" "),s("li",[t._v("package containerd.io-1.2.13-3.1.el7.x86_64 is excluded")]),t._v(" "),s("li",[t._v("package containerd.io-1.2.2-3.3.el7.x86_64 is excluded")]),t._v(" "),s("li",[t._v("package containerd.io-1.2.2-3.el7.x86_64 is excluded")]),t._v(" "),s("li",[t._v("package containerd.io-1.2.4-3.1.el7.x86_64 is excluded")]),t._v(" "),s("li",[t._v("package containerd.io-1.2.5-3.1.el7.x86_64 is excluded")]),t._v(" "),s("li",[t._v("package containerd.io-1.2.6-3.3.el7.x86_64 is excluded")])])]),s("p",[t._v("centos8默认使用podman代替docker，请安装")]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("yum install https://download.docker.com/linux/fedora/30/x86_64/stable/Packages/containerd.io-1.2.6-3.3.fc30.x86_64.rpm")]),t._v("\n:::")])]),t._v(" "),s("blockquote",[s("p",[t._v("如果需要最新版本的 Docker CE 请使用以下命令:")])]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("$ sudo yum"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("manager "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("enable docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ce"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("edge\n$ sudo yum"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("manager "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("enable docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ce"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("test\n")])])]),t._v(" "),s("h4",{attrs:{id:"安装-docker-compose-方便管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-docker-compose-方便管理"}},[t._v("#")]),t._v(" 安装 docker-compose（方便管理）")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### 方式1 ###")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 检查有没有，没有在执行下面的;否则直接2")]),t._v("\n$ pip "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("V\n$ pip install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("upgrade pip\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 步骤1")]),t._v("\n$ yum "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y install epel"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("release\n$ yum "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y install python"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("pip\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 步骤2")]),t._v("\n$ pip install docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("compose\n$ docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("compose "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("version\n")])])]),s("h3",{attrs:{id:"方式2-推荐"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方式2-推荐"}},[t._v("#")]),t._v(" 方式2 ### (推荐)")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("$ curl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("L https:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("compose"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("releases"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("download"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("25"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("5"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("compose"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("`uname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s`"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("`uname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m` > "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("compose\n$ chmod "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("local"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("compose\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("如果出现："),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("Traceback "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("most recent call last"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" File "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/bin/docker-compose"')]),t._v(", line "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("module"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("     from compose.cli.main "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("import")]),t._v(" main\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   File "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/lib/python2.7/site-packages/compose/cli/main.py"')]),t._v(", line "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("module"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("import")]),t._v(" docker\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   File "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/lib/python2.7/site-packages/docker/__init__.py"')]),t._v(", line "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("module"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("     from .api "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("import")]),t._v(" APIClient"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" 请安装"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("pip "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --upgrade backports.ssl_match_hostname`\n")])])]),s("h3",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),s("h4",{attrs:{id:"镜像相关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#镜像相关"}},[t._v("#")]),t._v(" 镜像相关")]),t._v(" "),s("h5",{attrs:{id:"搜索镜像-docker-search"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#搜索镜像-docker-search"}},[t._v("#")]),t._v(" 搜索镜像 docker search")]),t._v(" "),s("p",[t._v("命令格式："),s("code",[t._v("docker search [OPTIONS] TERM")])]),t._v(" "),s("p",[t._v("可选参数：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("--automated\t\t  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#只列出自动构建的镜像")]),t._v("\n--filter, -f\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#根据指定条件过滤结果")]),t._v("\n--limit\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v("\t     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#搜索结果的最大条数(默认25)")]),t._v("\n--no-trunc\t\t  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不截断输出，显示完整的输出")]),t._v("\n--stars, -s\t\t只展示Star不低于该数值的结果"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("默认0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h5",{attrs:{id:"下载镜像-docker-pull"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载镜像-docker-pull"}},[t._v("#")]),t._v(" 下载镜像 docker pull")]),t._v(" "),s("p",[t._v("命令格式："),s("code",[t._v("docker pull [OPTIONS] NAME[:TAG|@DIGEST]")])]),t._v(" "),s("p",[t._v("可选参数：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("--all-tags, -a\t   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#下载所有标签的镜像")]),t._v("\n--disable-content-trust\t\t  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#忽略镜像的校验(默认true)")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"http://cdn.gqsu.top/docker03-2.png",alt:""}})]),t._v(" "),s("p",[t._v("结果参数含义：")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("NAME")]),t._v("：镜像仓库名称。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("DESCRIPTION")]),t._v("：镜像仓库描述。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("STARS")]),t._v("：镜像仓库收藏数，表示该镜像仓库的受欢迎程度，类似于GitHub的Stars。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("OFFICAL")]),t._v("：表示是否为官方仓库，该列标记为[OK]的镜像均由各软件的官方项目组创建和维护。由结果可知，java这个镜像仓库是官方仓库，而其他的仓库都不是镜像仓库。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("AUTOMATED")]),t._v("：表示是否是自动构建的镜像仓库。")])])]),t._v(" "),s("h5",{attrs:{id:"列出镜像-docker-images"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#列出镜像-docker-images"}},[t._v("#")]),t._v(" 列出镜像 docker images")]),t._v(" "),s("p",[t._v("命令格式："),s("code",[t._v("docker images [OPTIONS] [REPOSITORY[:TAG]]")])]),t._v(" "),s("p",[t._v("可选参数：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("--all, -a\t\t "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#列出本地所有的镜像（含中间映像层，默认情况下，过滤掉中间映像层）")]),t._v("\n--digests\t\t "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#显示摘要信息")]),t._v("\n--filter, -f\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#显示满足条件的镜像")]),t._v("\n--format\t\t "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#通过Go语言模板文件展示镜像")]),t._v("\n--no-trunc\t\t "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不截断输出，显示完整的镜像信息")]),t._v("\n--quiet, -q\t\t "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#只显示镜像ID")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"http://cdn.gqsu.top/docker03-1.png",alt:""}})]),t._v(" "),s("p",[t._v("结果参数含义：")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("REPOSITORY")]),t._v("：镜像所属仓库名称。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("TAG")]),t._v("：镜像标签。默认是latest，表示最新。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("IMAGE ID")]),t._v("：镜像ID，表示镜像唯一标识。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("CREATED")]),t._v("：镜像创建时间。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("SIZE")]),t._v("：镜像大小。")])])]),t._v(" "),s("h5",{attrs:{id:"删除本地镜像-docker-rmi"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除本地镜像-docker-rmi"}},[t._v("#")]),t._v(" 删除本地镜像 docker rmi")]),t._v(" "),s("p",[t._v("命令格式："),s("code",[t._v("docker rmi [OPTIONS] IMAGE [IMAGE...]")])]),t._v(" "),s("p",[t._v("可选参数：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("--force, -f\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#强制删除")]),t._v("\n--no-prune\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不移除该镜像的过程镜像，默认移除")]),t._v("\n")])])]),s("h5",{attrs:{id:"删除所有没有引用的对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除所有没有引用的对象"}},[t._v("#")]),t._v(" 删除所有没有引用的对象")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("docker rmi "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("docker images "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" none "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$3")]),t._v("}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n")])])]),s("h5",{attrs:{id:"保存镜像-docker-save"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#保存镜像-docker-save"}},[t._v("#")]),t._v(" 保存镜像 docker save")]),t._v(" "),s("p",[t._v("命令格式："),s("code",[t._v("docker save [OPTIONS] IMAGE [IMAGE...]")])]),t._v(" "),s("p",[t._v("可选参数：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("--output, -o\t "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#输出到外部文件")]),t._v("\n")])])]),s("h5",{attrs:{id:"加载镜像-docer-load"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#加载镜像-docer-load"}},[t._v("#")]),t._v(" 加载镜像 docer load")]),t._v(" "),s("p",[t._v("命令格式："),s("code",[t._v("docker load [OPTIONS]")])]),t._v(" "),s("p",[t._v("可选参数：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("--input, -i\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#从文件加载而非STDIN")]),t._v("\n--quiet, -q\t\t "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#静默加载")]),t._v("\n")])])]),s("h5",{attrs:{id:"构建镜像-docker-build"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建镜像-docker-build"}},[t._v("#")]),t._v(" 构建镜像 docker build")]),t._v(" "),s("p",[t._v("命令格式："),s("code",[t._v("docker build [OPTIONS] PATH | URL | -")])]),t._v(" "),s("p",[t._v("可选参数：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("--add-host\t\t "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#添加自定义从host到IP的映射，格式为（host:ip）")]),t._v("\n--build-arg\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置构建时的变量")]),t._v("\n--cache-from\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#作为缓存源的镜像")]),t._v("\n--cgroup-parent\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器可选的父cgroup")]),t._v("\n--compress\t"),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#使用gzip压缩构建上下文")]),t._v("\n--cpu-period\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#限制CPU CFS (Completely Fair Scheduler) 周期")]),t._v("\n--cpu-quota\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#限制CPU CFS (Completely Fair Scheduler) 配额")]),t._v("\n--cpu-shares, -c\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#CPU使用权重（相对权重）")]),t._v("\n--cpuset-cpus\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定允许执行的CPU")]),t._v("\n--cpuset-mems\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定允许执行的内存")]),t._v("\n--disable-content-trust\t"),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#忽略校验")]),t._v("\n--file, -f\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定Dockerfile的名称，默认是‘PATH/Dockerfile’")]),t._v("\n--force-rm\t"),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除中间容器")]),t._v("\n--iidfile\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将镜像ID写到文件中")]),t._v("\n--isolation\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器隔离技术")]),t._v("\n--label\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置镜像使用的元数据")]),t._v("\n--memory, -m\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置内存限制")]),t._v("\n--memory-swap\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置Swap的最大值为内存+swap，如果设置为-1表示不限swap")]),t._v("\n--network\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#在构建期间设置RUN指令的网络模式")]),t._v("\n--no-cache\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#构建镜像过程中不使用缓存")]),t._v("\n--pull\t"),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#总是尝试去更新镜像的新版本")]),t._v("\n--quiet, -q\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#静默模式，构建成功后只输出镜像ID")]),t._v("\n--rm\t"),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#构建成功后立即删除中间容器")]),t._v("\n--security-opt\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安全选项")]),t._v("\n--shm-size\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定/dev/shm 目录的大小")]),t._v("\n--squash\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将构建的层压缩成一个新的层")]),t._v("\n--tag, -t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置标签，格式：name:tag，tag可选")]),t._v("\n--target\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置构建时的目标构建阶段")]),t._v("\n--ulimit\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Ulimit 选项")]),t._v("\n")])])]),s("h5",{attrs:{id:"运行镜像-docker-run"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行镜像-docker-run"}},[t._v("#")]),t._v(" 运行镜像 docker run")]),t._v(" "),s("p",[s("code",[t._v("docker run --name container-name -d -p 8088:80 image-name")])]),t._v(" "),s("p",[t._v("参数说明：")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d                        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 后台运行")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p 宿主机端口:容器端口       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开放容器端口到宿主机端口")]),t._v("\n")])])]),s("h4",{attrs:{id:"容器相关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器相关"}},[t._v("#")]),t._v(" 容器相关")]),t._v(" "),s("h5",{attrs:{id:"查看容器状态-运行-停止"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看容器状态-运行-停止"}},[t._v("#")]),t._v(" 查看容器状态（运行/停止）")]),t._v(" "),s("p",[s("code",[t._v("docker ps -a")])]),t._v(" "),s("h5",{attrs:{id:"启动容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动容器"}},[t._v("#")]),t._v(" 启动容器")]),t._v(" "),s("p",[s("code",[t._v("docker start container-name/container-id")])]),t._v(" "),s("h5",{attrs:{id:"停止容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#停止容器"}},[t._v("#")]),t._v(" 停止容器")]),t._v(" "),s("p",[s("code",[t._v("docker stop container-name/container-id")])]),t._v(" "),s("p",[t._v("还有一种强制关闭进程的方法(不推荐)：")]),t._v(" "),s("p",[s("code",[t._v("docker kill container-name/container-id")])]),t._v(" "),s("h5",{attrs:{id:"进入容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#进入容器"}},[t._v("#")]),t._v(" 进入容器")]),t._v(" "),s("p",[t._v("1、先查询出容器的pid：")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("docker inspect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("format "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{{.State.Pid}}"')]),t._v("  container"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("container"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("id\n")])])]),s("p",[t._v("2、根据容器的pid进入容器：")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("nsenter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("target "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$pid")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("uts "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("ipc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("net "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("pid\n")])])]),s("h5",{attrs:{id:"端口映射"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#端口映射"}},[t._v("#")]),t._v(" 端口映射")]),t._v(" "),s("p",[s("code",[t._v("docker run -d -p 6378:6379 --name port-reids redis")])]),t._v(" "),s("h5",{attrs:{id:"删除容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除容器"}},[t._v("#")]),t._v(" 删除容器")]),t._v(" "),s("p",[s("code",[t._v("docker rm container-id")])]),t._v(" "),s("p",[t._v("强制删除所有容器：")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("docker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("docker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("q"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h5",{attrs:{id:"容器日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器日志"}},[t._v("#")]),t._v(" 容器日志")]),t._v(" "),s("p",[s("code",[t._v("docker logs container-name/container-id")])]),t._v(" "),s("p",[t._v("动态查看日志："),s("code",[t._v("docker logs container-name/container-id -f")])]),t._v(" "),s("p",[t._v("查看最近30分钟日志："),s("code",[t._v("docker logs --since 30m container-name/container-id")])]),t._v(" "),s("h5",{attrs:{id:"容器端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器端口"}},[t._v("#")]),t._v(" 容器端口")]),t._v(" "),s("p",[s("code",[t._v("docker port container-name/container-id")])]),t._v(" "),s("h5",{attrs:{id:"容器ip地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器ip地址"}},[t._v("#")]),t._v(" 容器IP地址")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("docker inspect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("format "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{{ .NetworkSettings.IPAddress }}'")]),t._v(" container"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("container"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("id\n")])])]),s("h3",{attrs:{id:"其他"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[t._v("#")]),t._v(" 其他")]),t._v(" "),s("p",[t._v("1、进入容器内部bash：\n"),s("code",[t._v("docker exec -t -i container-name/container-id /bin/bash")])]),t._v(" "),s("blockquote",[s("p",[t._v("查询容器中的某一个目录XXX位置："),s("code",[t._v("docker exec -t -i container-name/container-id find / -name XXX")])])]),t._v(" "),s("blockquote",[s("p",[t._v("查询容器内目录的占用空间："),s("code",[t._v("du -chs /目录地址")])]),t._v(" "),s("p",[t._v("另一个进入容器方法为:"),s("code",[t._v("docker attach")]),t._v("但是此方法退出时会终止容器（不推荐）")])]),t._v(" "),s("p",[t._v("2、自动重启：")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("docker container update "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("restart=always "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ContainerName")]),t._v("\n")])])]),s("p",[s("code",[t._v("--restart=always")]),t._v("  、 "),s("code",[t._v("--restart=on-failure:5")])]),t._v(" "),s("p",[t._v("3、更多容器\n"),s("code",[t._v("docker inspect container-name/container-id")])]),t._v(" "),s("p",[t._v("4、一键查看docker内存占用和清理未运行的容器命令\n"),s("code",[t._v("docker system df")]),t._v(" 、 "),s("code",[t._v("docker system prune")])]),t._v(" "),s("p",[t._v("5、给已有的容器打标签,(打标签只是新增一个标识，仍为源镜像，打标签镜像大小不变)")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("$ docker images\n$ docker tag nginx:1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("13 nginx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("gqsu:1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("0\n")])])]),s("p",[t._v("6、"),s("code",[t._v("docker inspect")]),t._v("来查看该容器的详细信息。")]),t._v(" "),s("p",[t._v("7、在宿主机查看所有docker使用cpu，内存，网络，IO情况")]),t._v(" "),s("p",[s("code",[t._v("docker stats container-name/container-id -a")])]),t._v(" "),s("p",[t._v("8、查看docker磁盘使用情况")]),t._v(" "),s("p",[s("code",[t._v("docker system df")])]),t._v(" "),s("p",[t._v("9、查看docker镜像的存放位置")]),t._v(" "),s("p",[s("code",[t._v('docker info | grep "Docker Root Dir"')])]),t._v(" "),s("p",[t._v("10、移动目录到目标路径：")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##关闭服务")]),t._v("\nsystemctl stop docker\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##移动目录到目标目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("lib"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mydata"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker`\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##建立软连接")]),t._v("\nln "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mydata"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("lib"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker\n")])])]),s("p",[t._v("11、镜像启动。")]),t._v(" "),s("p",[t._v("源项目工程文件application.yml 文件配如下属性${XXX:YY}，在环境变量未指明时有默认值。")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://cdn.gqsu.top/docker02-03.png",alt:""}})]),t._v(" "),s("p",[t._v("docker-compose配置如下参数，即可启动：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_HOST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.31.130 \n")])])]),s("h3",{attrs:{id:"相关问题汇总"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#相关问题汇总"}},[t._v("#")]),t._v(" 相关问题汇总")]),t._v(" "),s("h4",{attrs:{id:"_1、docker容器时间与主机时间不一致"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、docker容器时间与主机时间不一致"}},[t._v("#")]),t._v(" 1、docker容器时间与主机时间不一致")]),t._v(" "),s("p",[t._v("可以分别通过命令："),s("code",[t._v("date")]),t._v(" 。查看当前主机和容器的时间是否一致，一般来说会差8个时区。")]),t._v(" "),s("ul",[s("li",[t._v("CST应该是指（China Shanghai Time，东八区时间）")]),t._v(" "),s("li",[t._v("UTC应该是指（Coordinated Universal Time，标准时间）")])]),t._v(" "),s("p",[t._v("最简单的方式就是，直接复制主机的 /etc/localtime 到容器中")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("docker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localtime:container"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("container"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localtime\n")])])]),s("p",[t._v("当然，在打包阶段你也可以事先指定，这样：")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置时区")]),t._v("\nRUN "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("zoneinfo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Asia"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Shanghai "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localtime \\\n    && "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Asia/Shanghai'")]),t._v(" >"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("timezone \\\n")])])]),s("p",[t._v("或者这样：")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v(" volumes:\n     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localtime:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localtime\n")])])]),s("h4",{attrs:{id:"_2、docker打包完成后的镜像文件很大-构建推送时间很长。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、docker打包完成后的镜像文件很大-构建推送时间很长。"}},[t._v("#")]),t._v(" 2、docker打包完成后的镜像文件很大，构建推送时间很长。")]),t._v(" "),s("p",[t._v("改变插件的打包逻辑，致使打包应用 Jar 时候将 lib 文件夹下所有的 Jar 包都拷贝到应用 Jar 外面，只留下编译好的字节码文件，将 lib 和 class 文件分离。（即依赖 lib 外置）")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugins")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--设置应用 Main 参数启动依赖查找的地址指向外部 lib 文件夹--\x3e")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.apache.maven.plugins"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("maven-jar-plugin"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("archive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("manifest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("addClasspath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("addClasspath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("classpathPrefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("lib/"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("classpathPrefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("manifest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("archive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--设置 SpringBoot 打包插件不包含任何 Jar 依赖包--\x3e")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-maven-plugin"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n             "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("includes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                 "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("nothing"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("nothing"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                 "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("includes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--设置将 lib 拷贝到应用 Jar 外面--\x3e")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.apache.maven.plugins"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("maven-dependency-plugin"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("executions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("execution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("copy-dependencies"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("phase")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("prepare-package"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("phase")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("goals")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("goal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("copy-dependencies"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("goal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("goals")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("outputDirectory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${project.build.directory}/lib"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("outputDirectory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("execution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("executions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugins")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("同时Dockerfile文件修改：")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" openjdk:8u212"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("b04"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("jre"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("slim\nVOLUME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("tmp\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 增加外部依赖进入打包依赖")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("COPY")]),t._v(" target"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("lib"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("lib"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\nADD target/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jar\nRUN sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'touch /app.jar'")]),t._v("\nENV JAVA_OPTS="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-Duser.timezone=Asia/Shanghai"')]),t._v("\nENV APP_OPTS="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\nENTRYPOINT "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sh"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-c"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_OPTS")]),t._v(" -Djava.security.egd=file:/dev/./urandom -jar /app.jar "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$APP_OPTS")]),t._v('"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("h4",{attrs:{id:"图形化工具安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图形化工具安装"}},[t._v("#")]),t._v(" 图形化工具安装")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("$ docker search portainer\n$ docker pull portainer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("portainer\n$ docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d \\ \n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p 9000:9000 \\   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# portainer默认端口是9000，映射到本地9000端口，通过本地地址访问 ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("restart=always \\  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置自动重启")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("run"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sock:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("run"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sock \\  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 单机必须指定docker.sock")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name Prtainer portainer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("portainer\n")])])]),s("p",[t._v("附录docker-compose.yml安装：")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("portainer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" portainer/portainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" portainer\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" portainer\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/run/docker.sock:/var/run/docker.sock"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./portainer/data:/data"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./portainer/Portainer-CN:/public"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("LANG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" en_US.UTF"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9000:9000"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("portainer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ipv4_address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.20.0.30\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("portainer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("external")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),s("p",[t._v("访问 http://localhost:9000")]),t._v(" "),s("h4",{attrs:{id:"swarm集群管理工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#swarm集群管理工具"}},[t._v("#")]),t._v(" Swarm集群管理工具")]),t._v(" "),s("p",[t._v("1、初始化")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("$ docker swarm init \\       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认初始化节点为管理节点")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("advertise"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("addr xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx \\   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定使用的ip")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("listen"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("addr xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx:2377   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定监听ip和port，默认为2377")]),t._v("\n")])])]),s("p",[t._v("2、设置manager节点")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("docker swarm "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join-token")]),t._v(" manager    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#获取管理节点token，放入下面命令")]),t._v("\n\n$ docker swarm join \\\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("advertise"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("addr xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx \\\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("listen"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("addr xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx:2377 \\\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("token SWMTKN"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("29ynh5uyfiiospy4fsm4pd4xucyji2rn0oj4b4ak4s7a37syf9"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ajkrv2ctjr5cmxzuij75tbrmz \\\nxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx:2377\n")])])]),s("p",[t._v("3、设置worker节点")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("docker swarm "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join-token")]),t._v(" worker    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#获取工作节点token，放入下面命令")]),t._v("\n\n$ docker swarm join \\\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("advertise"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("addr xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx \\\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("listen"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("addr xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx:2377 \\\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("token SWMTKN"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("29ynh5uyfiiospy4fsm4pd4xucyji2rn0oj4b4ak4s7a37syf9"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ajkrv2ctjr5cmxzuij75tbrmz \\\nxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xx:2377\n")])])]),s("p",[t._v("4、查看节点")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("$ docker node "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n")])])]),s("p",[t._v("5、创建服务")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("$ docker service create "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[OPTIONS]")]),t._v(" IMAGE "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[COMMAND]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[ARG...]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("detach "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d:  指定容器运行于前台还是后台，默认为false\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name:  服务名称\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("network:  网络连接\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("publish "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p:  端口映射\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("env "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e:  设置环境变量\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("tty "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("t:  分配tty设备，该可以支持终端登录\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(":  文件挂载\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("replicas:  指定任务数量\n")])])]),s("p",[t._v("参考：https://blog.csdn.net/hanzheng260561728/article/details/105138225/")]),t._v(" "),s("p",[t._v("最后，当需要在Docker Swarm 和 Kubernetes做出选择时，可以考虑如下几点：")]),t._v(" "),s("ul",[s("li",[t._v("你是否想依赖于Docker自己来解决集群的问题。如果是，选择Swarm。如果某些功能在Docker中不支持，那它也非常可能在Swarm中找不到，因为Swarm是依赖于Docker API的。")]),t._v(" "),s("li",[t._v("另外一方面，如果你想要一个工具可以解决Docker的限制，Kubernetes将是不错的选择。Kubernetes不是基于Docker，而是基于Google多年对于管理容器的经验。它是按照自己的方式来行事。")])])])}),[],!1,null,null,null);a.default=r.exports}}]);