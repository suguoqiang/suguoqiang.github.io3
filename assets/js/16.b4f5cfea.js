(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{508:function(a,t,s){"use strict";s.r(t);var e=s(6),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h3",{attrs:{id:"nginx安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx安装"}},[a._v("#")]),a._v(" nginx安装")]),a._v(" "),s("blockquote",[s("p",[a._v("Nginx的docker容器中，有一个默认配置文件 /etc/nginx/nginx.conf 。还有一个默认放配置文件的目录 /etc/nginx/conf.d。可以用默认目录文件替换掉默认配置文件。默认首页文件夹html路径/usr/share/nginx/html。")])]),a._v(" "),s("p",[a._v("1、从远程仓库拉取镜像文件nginx，"),s("code",[a._v(":latest")]),a._v("是标签，可以不加(生产环境需指明标签版本)。（也可以直接从远程镜像仓库中拉取并运行镜像，即步骤2）。")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker pull nginx:latest\n")])])]),s("p",[a._v("2、启动一个镜像，"),s("code",[a._v("--name")]),a._v("起名为 webserver（可不加），并映射宿主机的 80 端口到容器的 80 端口。")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("name webserver "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("d "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p 80:80 nginx\n")])])]),s("blockquote",[s("p",[a._v("此时直接访问宿主机的IP地址，可以出现nginx欢迎界面")])]),a._v(" "),s("p",[a._v("3、更改页面内容， 使用"),s("code",[a._v("docker exec")]),a._v("命令进入容器，并更改其内容。")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker exec "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("it webserver bash \nroot@3729b97e8226:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# echo '<h1>Hello, Docker!</h1>' > /usr/share/nginx/html/index.html ")]),a._v("\nroot@3729b97e8226:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# exit")]),a._v("\n")])])]),s("blockquote",[s("p",[a._v("可通过"),s("code",[a._v("docker diff webserver")]),a._v("查看前后操作发生了那些变化。也可以直接执行命令，如进入redis容器内部执行redis-cli："),s("code",[a._v("docker exec -it my-redis redis-cli")])])]),a._v(" "),s("p",[a._v("4、保存修改的容器为镜像（实际情况下，尽量不要使用，不推荐；强烈建议使用 Dockerfile）。")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker commit \\    \n>"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("author "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Tao Wang <twang2218@gmail.com>"')]),a._v(" \\    \n>"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("message "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"修改了默认网页"')]),a._v(" \\    \n>webserver \\    \n>nginx:v2 \nsha256:07e33465974800ce65751acc279adc6ed2dc5ed4e0838f8b86f0c87aa1795214\n")])])]),s("p",[a._v("5、删除之前的并启动自己的容器。")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("name webserver "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("d "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p 80:80 nginx:v2\n")])])]),s("p",[a._v("6、 比较不同版本的区别,使用"),s("code",[a._v("docker history")]),a._v("命令")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker history nginx:v2\n")])])]),s("blockquote",[s("p",[a._v("nginx做图片映射的时候，一定要将本地的映射目录与容器映射关系确定好，不然容器内找不到目录映射。一般不推荐使用这种方式做图片服务器映射，因为要存两份文件，太占用内存。当然，可以使用 "),s("code",[a._v("docker ps -s")]),a._v("查看容器占用的空间大小。（有待验证）")])]),a._v(" "),s("p",[a._v("备注：配置文件 nginx.conf")]),a._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("server")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("{")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("    listen")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("80;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("    charset")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("utf-8;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("    access_log")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("off;")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#    location / {")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#        proxy_pass http://app:8080;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#        proxy_set_header Host $host:$server_port;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#        proxy_set_header X-Forwarded-Host $server_name;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#        proxy_set_header X-Real-IP $remote_addr;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#    }")]),a._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("     #默认请求")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("     location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("/ {")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("          root")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("/usr/share/nginx/html;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("          #定义首页索引文件的名称")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("          index")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("index.html index.htm;   ")]),a._v("\n     }\n  \n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("     location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("/me {")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("        root")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("  /usr/share/nginx/html;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("        index")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v(" index.html;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("     }")]),a._v(" \n\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("     location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("/funny {")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("        root")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("  /usr/share/nginx/html;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("        index")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v(" index.html;")]),a._v("\n     }\n\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("     location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("/birth {")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("        root")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("  /usr/share/nginx/html;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("        index")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v(" index.html;")]),a._v("\n     }\n\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("     location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("/element {")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("        root")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("  /usr/share/nginx/html;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("        index")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v(" index.html;")]),a._v("\n     }\n\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("     location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("/ourlove {")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("        root")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("  /usr/share/nginx/html;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("        index")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v(" index.html;")]),a._v("\n     }\n     \n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("     location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("/vip {")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("        root")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("  /usr/share/nginx/html;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("        index")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v(" index.html;")]),a._v("\n     }\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("    # location ^~/admin/ {        ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("    #\tproxy_redirect   off;        ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("    #\tproxy_set_header   Host $host;  ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("    #\tproxy_set_header   X-real-ip $remote_addr;    ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("    #\tproxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for; ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("    #\tproxy_pass    http://localhost:9999/admin/;  ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("    #} ")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("     location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("/api{")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("        proxy_pass")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("http://192.168.1.1:9999/api;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('        # access_log "logs/test.log";')]),a._v("\n    }\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("    #默认请求(映射，可配置成浏览器访问)")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("    location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("/img {")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("         #定义映射的路径（还有一种是alias，这里不做详讨）")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("         root")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v(" /home;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("         #定义首页索引文件的名称")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("         index")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("index.php index.html index.htm;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("         #开启目录浏览功能(开启该功能后，index.html不可以存在，否则读出来的是页面)")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("         autoindex")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("on;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("         #显示出文件的确切大小")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("         autoindex_exact_size")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("off;")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("         #显示的文件时间为文件的服务器时间")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("         autoindex_localtime")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("on;")]),a._v("\n     }\n}\n\n")])])]),a._v(" "),s("h3",{attrs:{id:"mysql安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql安装"}},[a._v("#")]),a._v(" mysql安装")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker pull mysql:5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("7\n$ docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("name mysql "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p 3306:3306 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("e MYSQL_ROOT_PASSWORD=root "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("d mysql:5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("7\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#$ docker run --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root -v /data/mysql/data:/var/lib/mysql -v /data/mysql/config/my.cnf:/etc/my.cnf -v /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime -d mysql:5.7")]),a._v("\n$ docker "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("##使用`exec`，进入容器内部,操作mysql")]),a._v("\n$ docker exec "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("it container"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("id bash\n$ mysql "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("u root "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p\n")])])]),s("h3",{attrs:{id:"redis-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis-安装"}},[a._v("#")]),a._v(" redis 安装")]),a._v(" "),s("p",[a._v("1、查看redis有哪些键值对并进行相关操作")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("it "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("name some"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("link yl"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" redis redis"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cli")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("h yl"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p 6379\n")])])]),s("blockquote",[s("p",[a._v("格式："),s("code",[a._v("docker run -it --name redis --link [容器名称] --rm [镜像名称] redis-cli -h [容器名称] -p 6379")])])]),a._v(" "),s("p",[a._v("如果报错："),s("img",{attrs:{src:"http://cdn.gqsu.top/docker05-1.png",alt:""}})]),a._v(" "),s("p",[a._v("可以这样解决："),s("code",[a._v("docker network ls")]),a._v("列出所有网络,选择名称对应的网络地址(此处为:yiliao-default).")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://cdn.gqsu.top/docker05-2.png",alt:""}})]),a._v(" "),s("p",[a._v("改写上面的代码,即可正确访问：")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("it "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("name some"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("link yl"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("net yiliao_default "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" redis redis"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cli")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("h yl"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p 6379\n")])])]),s("p",[a._v("2、如果安装的是docker非简洁版，可以使用"),s("code",[a._v("docker exec")]),a._v("命令来操作")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker exec "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("it "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("[docker进程ID标识]")]),a._v(" bash\n")])])]),s("p",[a._v("这样，就相当于进入了容器内部，操作与windows是一致的。")]),a._v(" "),s("h3",{attrs:{id:"jenkins安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jenkins安装"}},[a._v("#")]),a._v(" Jenkins安装")]),a._v(" "),s("p",[a._v("参考：https://blog.csdn.net/mmd0308/article/details/77206563?locationNum=6&fps=1，然后并不推荐docker安装，会出现很多问题，比如插件安装不上，因为docker版本的不是最新的。")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ mkdir ~"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jenkins\n$ docker pull jenkins\n$ chown "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("R 1000:1000 jenkins"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("\n")])])]),s("blockquote",[s("p",[a._v("这里的权限一定要赋值为1000:1000，否则会报无权限操作。至于原因可能和docker配置有关（通过docker logs查看日志获得）。\n"),s("img",{attrs:{src:"http://cdn.gqsu.top/jenkins01.png",alt:""}})])]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("d "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p 8088:8080 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p 50000:50000 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("name jenkins  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("v `"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("pwd")]),a._v("`"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jenkins:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("jenkins_home "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("privileged=true jenkins\n$ docker "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\n$ docker logs jenkins\n")])])]),s("p",[a._v("安装完成，登录8088端口使用页面，初次登录需要密码：\n密码的获取地址为：\n1."),s("code",[a._v("cat ./jenkins/secrets/initialAdminPassword")]),s("br"),a._v("\n2."),s("code",[a._v("docker exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword")])]),a._v(" "),s("h3",{attrs:{id:"rabbitmq安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq安装"}},[a._v("#")]),a._v(" RabbitMQ安装")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker search rabbitmq\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("##这里的版本为management，即带操作界面的版本")]),a._v("\n$ docker pull rabbitmq:3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("7"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("7"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("management\n$ docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("d "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("name rabbitmq "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p 5672:5672 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p 15672:15672 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("v `"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("pwd")]),a._v("`"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("data")]),a._v(":"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("lib"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("rabbitmq "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("e RABBITMQ_DEFAULT_VHOST=my_vhost  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("e RABBITMQ_DEFAULT_USER=admin "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("e RABBITMQ_DEFAULT_PASS=admin rabbitmq:3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("7"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("7"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("management\n")])])]),s("h3",{attrs:{id:"gogs安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gogs安装"}},[a._v("#")]),a._v(" Gogs安装")]),a._v(" "),s("blockquote",[s("p",[a._v("gogs需要数据库支持，请确保已安装mysql")])]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker pull gogs"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("gogs\n$ mkdir "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("gogs\n$ docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("name=gogs "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p 10022:22 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p 10080:3000 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("v "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("gogs:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("data")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("d gogs"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("gogs\n$ docker "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\n")])])]),s("p",[a._v("配置文件修改（./gogs/conf/app.ini）:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("APP_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" Gogs\nRUN_USER "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v("\nRUN_MODE "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" prod\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nDB_TYPE  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mysql\nHOST     "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mysql57:3306    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 注意这里, 是docker中连接通网络,其它容器服务的方式")]),a._v("\nNAME     "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" gogs\n"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("USER")]),a._v("     "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" root\nPASSWD   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" root\nSSL_MODE "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" disable\n"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")]),a._v("     "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" data/gogs.db\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("repository"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nROOT "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /data/git/gogs-repositories\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nDOMAIN           "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" localhost\nHTTP_PORT        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3000")]),a._v("\nROOT_URL         "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" http://localhost:10080/   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 这个就是图形界面的应用URL的值")]),a._v("\nDISABLE_SSH      "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\nSSH_PORT         "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10022")]),a._v("\nSTART_SSH_SERVER "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\nOFFLINE_MODE     "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("mailer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nENABLED "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nREGISTER_EMAIL_CONFIRM "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\nENABLE_NOTIFY_MAIL     "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\nDISABLE_REGISTRATION   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\nENABLE_CAPTCHA         "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\nREQUIRE_SIGNIN_VIEW    "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("picture"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nDISABLE_GRAVATAR        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\nENABLE_FEDERATED_AVATAR "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nPROVIDER "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nMODE      "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),a._v("\nLEVEL     "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" Info\nROOT_PATH "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /app/gogs/log\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("security"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nINSTALL_LOCK "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\nSECRET_KEY   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" nV8DDKEN2IExVjr\n")])])]),s("p",[a._v("更多案例请访问:"),s("a",{attrs:{href:"https://docs.docker-cn.com/",target:"_blank",rel:"noopener noreferrer"}},[a._v("中文官方"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"gitlab安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab安装"}},[a._v("#")]),a._v(" GitLab安装")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker search gitlab\n$ docker pull gitlab"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("gitlab"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("ce\n")])])]),s("p",[a._v("1.这里通过自启动脚本的方式 。添加启动文件 start.sh，并赋予权限chmod 755")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("HOST_NAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("gitlab.gqsu.top\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("GITLAB_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\ndocker stop gitlab\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" gitlab\ndocker run -d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --hostname "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${HOST_NAME}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -p "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8443")]),a._v(":443 -p "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8888")]),a._v(":80 -p "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2222")]),a._v(":22 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --name gitlab "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -v "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${GITLAB_DIR}")]),a._v("/config:/etc/gitlab "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -v "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${GITLAB_DIR}")]),a._v("/logs:/var/log/gitlab "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    -v "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${GITLAB_DIR}")]),a._v("/data:/var/opt/gitlab "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    gitlab/gitlab-ce:latest\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[a._v("运行start.sh 启动gitlab")])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" start.sh\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[a._v("配置环境")])]),a._v(" "),s("ul",[s("li",[a._v("修改host文件，使域名可以正常解析")])]),a._v(" "),s("blockquote",[s("p",[a._v("127.0.0.1 gitlab.gqsu.top")])]),a._v(" "),s("h3",{attrs:{id:"zookeeper安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper安装"}},[a._v("#")]),a._v(" Zookeeper安装")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker pull zookeeper\n$ docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("dit "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p 2181:2181 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("name zookeeper "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("restart=always zookeeper\n$ docker logs zookeeper\n")])])]),s("h3",{attrs:{id:"禅道安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#禅道安装"}},[a._v("#")]),a._v(" 禅道安装")]),a._v(" "),s("p",[a._v("安装包下载地址：http://dl.cnezsoft.com/zentao/docker/docker_zentao.zip")]),a._v(" "),s("p",[a._v("默认数据库用户名： root,默认密码： 123456。运行时，可以设置 MYSQL_ROOT_PASSWORD变量来更改密码。")]),a._v(" "),s("p",[a._v("可挂载目录："),s("code",[a._v("/app/zentaopms")]),a._v(":该目录为禅道目录，里面包含禅道代码及附件上传目录。\n"),s("code",[a._v("/var/lib/mysql")]),a._v(":该目录为数据库的数据目录。")]),a._v(" "),s("p",[a._v("1、"),s("strong",[a._v("构建镜像")])]),a._v(" "),s("p",[a._v("下载安装包，解压缩。 进入docker_zentao目录")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker build "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("t zentao "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("\n")])])]),s("p",[a._v("2、运行镜像")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("name docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("zentao "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p 80:80 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("v "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("chandao:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("zentaopms "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("v "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("mysql:"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("lib"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("mysql "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("e MYSQL_ROOT_PASSWORD=123456 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("d zentao:latest\n")])])]),s("h3",{attrs:{id:"开源云项目-云收藏-笔记"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开源云项目-云收藏-笔记"}},[a._v("#")]),a._v(" 开源云项目--云收藏（笔记）")]),a._v(" "),s("p",[a._v("1、最新版的采用了docker部署，安装与部署详见README.md文件")]),a._v(" "),s("p",[a._v("2、修改了docker-compose.yml文件后，一定要先删除容器，然后在执行一遍"),s("code",[a._v("docker-compose up -d")]),a._v("。单纯的停止，在启动容器是不会生效的。\n如：现在要增加容器内置的nginx的图片目录预览功能，修改docker-compose.yml,在nginx模块：")]),a._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[a._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n   container_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" favorites"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("nginx\n   image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("1.13\n   restart"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" always\n   ports"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 80"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("80\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 443"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("443\n   volumes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#劵")]),a._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./nginx/conf.d"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/etc/nginx/conf.d\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" /tmp/logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/log/nginx\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("###增加的行，前面是宿主机的地址，后面是映射到的容器地址。这样就可以操作宿主机实现容器的拷贝")]),a._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" /home/share"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/home/share\n")])])]),s("h3",{attrs:{id:"harbor-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#harbor-安装"}},[a._v("#")]),a._v(" Harbor 安装")]),a._v(" "),s("p",[a._v("1、下载Harbor：https://github.com/goharbor/harbor/releases")]),a._v(" "),s("p",[a._v("2、执行：")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\n$ tar "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("zxvf harbor"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("offline"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("installer"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("v1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("tgz\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#输出如下")]),a._v("\nharbor"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("harbor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("v1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("tar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("gz\nharbor"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("prepare\nharbor"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("LICENSE\nharbor"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("install"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("sh\nharbor"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("harbor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("yml\n")])])]),s("p",[a._v("3、ssl配置")]),a._v(" "),s("ul",[s("li",[a._v("生成密钥和自签证书："),s("code",[a._v("openssl req -newkey rsa:4096 -nodes -sha256 -keyout ca.key -x509 -days 365 -out ca.crt")])]),a._v(" "),s("li",[a._v("证书签名请求："),s("code",[a._v("openssl req -newkey rsa:4096 -nodes -sha256 -keyout harbor.dockerregistry.com.key -out harbor.dockerregistry.com.csr")])]),a._v(" "),s("li",[a._v("生成csr文件："),s("code",[a._v("openssl x509 -req -days 365 -in harbor.dockerregistry.com.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out harbor.dockerregistry.com.crt")])])]),a._v(" "),s("p",[a._v("3、修改配置文件： "),s("code",[a._v("vi harbor.yml")])]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 修改为域名或你服务器 IP")]),a._v("\nhostname: 192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("203  \n\nhttp:\n  port: 80\n  \nhttps:\n  port: 443\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 修改如下两项为实际的工作目录文件harbor.dockerregistry.com.crt、harbor.dockerregistry.com.key")]),a._v("\n  certificate: "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("home"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("work"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("registry"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("harbor"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("harbor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dockerregistry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("crt\n  private_key: "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("home"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("work"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("docker"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("registry"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("harbor"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("harbor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dockerregistry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("key\n\n")])])]),s("p",[a._v("4、执行安装脚本")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("install"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("sh \n")])])]),s("p",[a._v("5、验证是否成功，http://192.168.0.203")]),a._v(" "),s("p",[a._v("6、输入账号: admin，密码: Harbor12345，验证登录成功与否。")]),a._v(" "),s("p",[a._v("7、Harbor 启动和停止\nHarbor 的日常运维管理是通过 docker-compose 来完成的，Harbor 本身有多个服务进程，都放在 docker 容器之中运行，我们可以通过 docker ps 命令查看。\n启动： "),s("code",[a._v("docker-compose start")]),a._v("\n停止： "),s("code",[a._v("docker-compose stop")])]),a._v(" "),s("ul",[s("li",[a._v("nginx： nginx 负责流量转发和安全验证，对外提供的流量都是从 nginx 中转，所以开放 https 的 443 端口，它将流量分发到后端的 ui 和正在 docker 镜像存储的 docker registry。")]),a._v(" "),s("li",[a._v("harbor-jobservice： harbor-jobservice 是 harbor 的 job 管理模块，job 在 harbor 里面主要是为了镜像仓库之前同步使用的；")]),a._v(" "),s("li",[a._v("harbor-ui： harbor-ui 是 web 管理页面，主要是前端的页面和后端 CURD 的接口；")]),a._v(" "),s("li",[a._v("registry： registry 就是 docker 原生的仓库，负责保存镜像。")]),a._v(" "),s("li",[a._v("harbor-adminserver： harbor-adminserver 是 harbor 系统管理接口，可以修改系统配置以及获取系统信息。")]),a._v(" "),s("li",[a._v("harbor-db： harbor-db 是 harbor 的数据库，这里保存了系统的 job 以及项目、人员权限管理。由于本 harbor 的认证也是通过数据，在生产环节大多对接到企业的 ldap 中；")]),a._v(" "),s("li",[a._v("harbor-log： harbor-log 是 harbor 的日志服务，统一管理 harbor 的日志。通过 inspect 可以看出容器统一将日志输出的 syslog。")])]),a._v(" "),s("blockquote",[s("p",[a._v("这几个容器通过 Docker link 的形式连接在一起，这样，在容器之间可以通过容器名字互相访问。对终端用户而言，只需要暴露 proxy （即 Nginx）的服务端口。")])]),a._v(" "),s("p",[a._v("8、配置客户端\n在 /etc/docker/daemon.json 中增加如下内容（如果文件不存在请新建该文件）")]),a._v(" "),s("p",[a._v("重启服务")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("systemctl daemon"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("reload\nsystemctl restart docker\n")])])]),s("p",[a._v("9、检查客户端配置是否生效，使用"),s("code",[a._v("docker info")]),a._v("查看能否出现如下信息：")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("Insecure Registries:\n 192.168.0.203\n 127.0.0.0/8\n")])])]),s("p",[a._v("10、Harbor 上传镜像\n首先需要在 Harbor 上创建一个 公开/私有 的项目。")]),a._v(" "),s("p",[a._v("11、推送镜像")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 在项目中标记镜像")]),a._v("\n$ docker tag nginx 192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("141"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("150"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("myshop"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("nginx:latest\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 登录 Harbor")]),a._v("\n$ docker login 192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("141"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("150 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("u admin "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("p Harbor12345\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 推送镜像到项目")]),a._v("\n$ docker push 192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("141"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("150"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("myshop"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("nginx:latest\n")])])]),s("p",[a._v("12、查看镜像")]),a._v(" "),s("p",[a._v("13、Harbor 下载镜像")]),a._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[a._v("$ docker pull 192"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("168"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("141"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("150"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("myshop"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("nginx:latest\n")])])]),s("h3",{attrs:{id:"nextcloud安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nextcloud安装"}},[a._v("#")]),a._v(" nextcloud安装")]),a._v(" "),s("p",[a._v("https://blog.csdn.net/shangyexin/article/details/106306680")]),a._v(" "),s("p",[a._v("https://blog.csdn.net/weixin_42315182/article/details/104629951")])])}),[],!1,null,null,null);t.default=r.exports}}]);